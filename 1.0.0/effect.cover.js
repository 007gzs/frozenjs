define(function(a,b,c){function d(a){var b=a.css("position");return"relative"===b||"fixed"===b||"absolute"===b?!0:!1}function e(a){a.preventDefault()}var f=a("arale/widget/1.1.1/widget"),g=a("arale/widget/1.1.1/daparser"),h=a("gallery/zepto/1.1.3/zepto"),i=f.extend({attrs:{element:h("body"),trigger:{value:null,getter:function(a){return this.element.find(a)}},dismiss:{value:null,getter:function(a){return this.element.find(a)}},background:{value:"random",getter:function(a){return"random"==a?"#"+("00000"+(16777216*Math.random()<<0).toString(16)).slice(-6):a}},shape:{value:"square",getter:function(a){return"random"==a?parseInt(10*Math.random())%2==1?"square":"round":a}},fromSkew:{value:"random",getter:function(a){return"random"==a?[20*Math.random()-10,20*Math.random()-10]:a}},duration:1e3,startPos:{value:"source"},offset:[0,0],expandAxis:"y",isFloat:!0,zIndex:999},setup:function(){i.superclass.setup.call(this),this.initMask(),this.render(),this._isShown=!1,this._isDismiss=!1,this._bindTrigger(),this.position||(this.position={},this.position.screenWidth=document.documentElement.clientWidth,this.position.screenHeight=document.documentElement.clientHeight)},initMask:function(){this._mask=h("<div></div>"),this._mask.css({position:"absolute",top:0,left:0,width:100,height:100,"z-index":-1,"-webkit-transform":"scale(0)"})},render:function(){return this._mask.appendTo(this.element),d(this.element)||this.element.css({position:"relative",overflow:"hidden"}),i.superclass.render.call(this),this},setConfig:function(a){if(a.trigger&&(this.currentTrigger=h(a.trigger)),this.currentTrigger||(this.currentTrigger=this.get("trigger")),!this._isShown){var b=g.parseElement(this.currentTrigger);a=h.extend(a,b),this.currentConfig=a}return this},show:function(a){var b=this.currentConfig;if(!this._isShown&&(this.currentTrigger||a)){a&&(this.currentTrigger=a),this._preventDefault(),self._isDismiss=!1,this._isShown=!0;var c=b.shape||this.get("shape"),d=void 0!=b.isFloat?b.isFloat:this.get("isFloat"),e=b.background||this.get("background"),f=b.startPos||this.get("startPos"),g=b.offset||this.get("offset"),h=b.expandAxis||this.get("expandAxis"),i=b.zIndex||this.get("zIndex"),j=b.fromSkew||this.get("fromSkew"),k=b.duration||this.get("duration"),l=2;d&&(this._floatTrigger(),this.currentTrigger.css({zIndex:i+1})),"round"==c?(this._mask.css({"border-radius":"50px"}),l=3):this._mask.css({"border-radius":"0px"});var m=this._getMaskPos(f,h),n="x"==h?"scale(0,1)":"y"==h?"scale(1,0)":"scale(0,0)";this._mask.css({left:m[0]+g[0],top:m[1]+g[1],background:e,"z-index":i,"-webkit-transform":n+" skew("+j[0]+"deg,"+j[1]+"deg)"}),this._aniMask(k,g,l)}return this},hide:function(){return this._isShown&&(this._isDismiss=!0,this._mask.css({"-webkit-transform":this._originTransform})),this},shown:function(){},hidden:function(){this._isShown=!1,this._isDismiss=!1,this._mask.css({"-webkit-transition":"none"}),this._relaseDefault(),this.currentTrigger.css(this._triggerOriginCss)},_bindTrigger:function(){var a=this,b="click";h.os.phone&&(b="tap"),this.get("trigger").on(b,function(){a._isShown||(a.currentTrigger=h(this));var b=g.parseElement(h(this));return a.setConfig(b).show(h(this)),!1}),this.get("dismiss").on(b,function(){return a._dismiss=h(this),a.hide(),!1}),this._mask[0].addEventListener("webkitTransitionEnd",function(){a._isShown&&!a._isDismiss?a.shown():a.hidden()},!1)},_preventDefault:function(){document.addEventListener("mousewheel",e,!1),document.body.addEventListener("touchmove",e,!1),document.documentElement.addEventListener("touchmove",e,!1)},_relaseDefault:function(){document.removeEventListener("mousewheel",e,!1),document.body.removeEventListener("touchmove",e,!1),document.documentElement.removeEventListener("touchmove",e,!1)},_floatTrigger:function(){this._triggerOriginCss={position:this.currentTrigger.css("position"),"z-index":this.currentTrigger.css("z-index")},d(this.currentTrigger)||this.currentTrigger.css({position:"relative"})},_getMaskPos:function(a,b){this.position||(this.position={},this.position.screenWidth=document.documentElement.clientWidth,this.position.screenHeight=document.documentElement.clientHeight),"x"==b?this._mask.css({height:this.position.screenHeight}):"y"==b&&this._mask.css({width:this.position.screenWidth}),this.position.scrollTop=document.body.scrollTop,this.position.scrollLeft=document.body.scrollLeft,this.position.offsetTop=this.element.offset().top,this.position.offsetLeft=this.element.offset().left,this.position.triggerLeft=this.currentTrigger.offset().left,this.position.triggerTop=this.currentTrigger.offset().top,this.position.triggerHeight=this.currentTrigger.height(),this.position.triggerWidth=this.currentTrigger.width();var c=parseInt(this._mask.css("width")),d=parseInt(this._mask.css("height")),e=this.position.scrollLeft-this.position.offsetLeft+this.position.screenWidth/2-c/2,f=0;return"top"==a?f=this.position.scrollTop-this.position.offsetTop-d/2:"bottom"==a?f=this.position.scrollTop-this.position.offsetTop+this.position.screenHeight-d/2:"center"==a?f=this.position.scrollTop-this.position.offsetTop+this.position.screenHeight/2-d/2:(e=this.position.triggerLeft-this.position.offsetLeft+this.position.triggerWidth/2-c/2,f=this.position.triggerTop-this.position.offsetTop+this.position.triggerHeight/2-d/2),[e,f]},_aniMask:function(a,b,c){var d=this;this._originTransform=this._mask.css("-webkit-transform");var e=Math.ceil(this.position.screenWidth/parseInt(this._mask.css("width")))*c,f=Math.ceil(this.position.screenHeight/parseInt(this._mask.css("height")))*c;setTimeout(function(){d._mask.css({"-webkit-transition":"all "+a+"ms","-webkit-transform":"scale("+e+","+f+") skew(0deg,0deg)"})},200)}});c.exports=i});